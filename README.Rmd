---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# hottest100

<!-- badges: start -->
[![R-CMD-check](https://github.com/katerobsau/hottest100/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/katerobsau/hottest100/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/katerobsau/hottest100/graph/badge.svg)](https://app.codecov.io/gh/katerobsau/hottest100)
<!-- badges: end -->

The goal of hottest100 is to provide a compendium of Triple J hottest 100 songs. Data is scraped from [Triple J's best 100 Australian songs](https://www.abc.net.au/triplej/countdown/hottest100/australiansongs)
and historic information on [Wikipedia](https://en.wikipedia.org/wiki/Triple_J_Hottest_100).

There are three data sets on artists, tracks, and polls. 

## Installation

You can install the development version of hottest100 from [GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("katerobsau/hottest100")
```

## Data sets available

```{r}
library(hottest100)
library(tibble)
library(dplyr)
```

### Tracks

Triple J Hottest 100 Track Data - A dataset containing track-level data from the Triple J Hottest 100. A data.frame with one row per track, including variables:

* __alltime__: Logical; indicates if the entry is from an all-time chart specific year.
* __artist__: Character; name of the artist or band associated withtrack.
* __country__: Character; the country associated with the track/chart.
* __id__: Unique identifier for each track (within year)
* __pollyear__: Countdown poll year
* __position__: Chart position of the track.
* __track__: Title of the track or song.
* __releaseyear__: Original release year of the track.

```{r}
as_tibble(tracks)
# What are the top 1 tracks not incuding the "alltime" counts
tracks |>
 filter(
   position == 1,
   alltime == FALSE
 ) |>
 arrange(pollyear) |>
 select(
   pollyear,
   position,
   track,
   artist
 )
```

### Polls

Triple J Hottest 100 Polls. A dataset with information about each Triple J Hottest 100 poll. 

A data.frame with one row per countdown, including variables:

* __year__: The year the poll was held.
* __alltime__: Logical; whether the poll was an "All-Time" countdown
* __alltimedescription__: A description of the poll, if applicable.
* __colorRGB__: Primary RGB color value associated with the year in character format.
* __contrastColorRGB__: Contrasting RGB color value (in character format) suitable for text overlay.

```{r}
as_tibble(polls)
```

### Artists

Triple J Hottest 100 Artists. A deduplicated dataset of artists represented in the Triple J Hottest 100, created from `tracks`.
 
* __artist__: Artist name
* __country__: Country of origin
* __releaseyear__: Release year of included track


```{r}
as_tibble(artists)
# who has appeared 10 or more times?
artists |>
 count(artist, sort = TRUE) |>
 filter(n >= 10)

# top 10 artists?
artists |>
 count(country, sort = TRUE) |>
 slice_max(n = 10, order_by = n)
```

# Old timers and newbies

The artists that are appearing frequently are an interesting mix of old timers and newbies.  For the most common artists, have they had a long career, or did they rocket up the charts quickly? 

```{r hit-velocity}
#| fig.width: 7
#| fig.height: 5
library(ggplot2)
library(ggrepel)

tracks |>
  filter(!alltime )|>
  semi_join(
    # Filter to only the artists with the most appearances
    {tracks |>
      filter(!alltime ) |>
      group_by(artist) |>
      summarise(count = n()) |>
      ungroup() |>
      slice_max(count, n = 10)}
  ) |>
  group_by(artist, pollyear) |>
  summarise(hits = n()) |>
  ungroup() |>
  arrange(artist, pollyear) |>
  group_by(artist) |>
  mutate(cumulative_hits = cumsum(hits)) |>
  ungroup() |>
  group_by(artist) |>
  mutate(total_hits = sum(hits)) |>
  # Adding a filtered version of the artist's name for use in labelling the chart
  mutate(artist_name = ifelse(total_hits == cumulative_hits, artist, NA_character_)) |>
  # We'll use artist_name_y to offset the name positions a bit from the actual points so we can see both
  mutate(artist_name_y = ifelse(total_hits == cumulative_hits, cumulative_hits + 1, NA_integer_)) |>
  ungroup() |>
  ggplot(aes(x = pollyear, y = cumulative_hits, group = artist, col = artist)) +
  geom_line() +
  geom_point() +
  geom_label_repel(aes(y = artist_name_y, label = artist_name)) +
  theme_bw() +
  theme(legend.position = 'none') +
  scale_x_continuous(limits = c(NA, 2030)) +
  labs(title = "Comparative velocity of most popular Triple J Hottest 100 artists over time",
       caption = "10 artists with the most songs across time in the 'this year' polls")

```
